<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Yourssu 기술 블로그</title>
        <meta name="author">
        <meta name="description" content="Yourssu Development blog ">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.60.1" />
        
        <link href='https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap" rel="stylesheet' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://blog.yourssu.com/css/styles.css">
        <link rel="icon" href="https://blog.yourssu.com/favicon.ico">
        <link rel="apple-touch-icon" href="https://blog.yourssu.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="https://blog.yourssu.com/css/highlightjs/monokai.css">
        <script src="https://blog.yourssu.com/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(https://blog.yourssu.com/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(https://blog.yourssu.com/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(https://blog.yourssu.com/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        
        <header class="site-header">
          <div class="transparent-layer">
              <a href="https://blog.yourssu.com/"><img src= "https://blog.yourssu.com/img/LOGO.png" alt="LOGO" class = "Logo_img"></a>
          </div>
        </header>

<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="https://blog.yourssu.com/" title="돌아가기">&laquo; 돌아가기</a>
            
<h1><a href="https://blog.yourssu.com/post/%EC%8B%A4%EC%A0%9C%EC%BD%94%EB%93%9C%EB%A1%9C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-dagger/" title="실제코드로 알아보는 dagger">실제코드로 알아보는 dagger</a></h1>

<footer class="post-info">Posted on <span class="post-meta"><time datetime="2019.12.07">2019.12.07</time>

    &middot; Tagged in
        
        <a href="https://blog.yourssu.com/tags/android">android</a>, 
        
        <a href="https://blog.yourssu.com/tags/dagger">dagger</a>, 
        
        <a href="https://blog.yourssu.com/tags/di">di</a>
        
    

</span>
</footer>

            <h1 id="--dagger">실제코드로 알아보는 dagger</h1>
<p>유어슈에서 안드로이드 개발을 하고 있는 박정현입니다 오늘은 Android에서 DI(dependence injection) 문제를 해결하기 위해
가장 많이 쓰이고 있는 dagger2에 대해 보다 쉽게 알아보겠습니다</p>
<p>처음 안드로이드 개발을 시작하는 분들은 dagger의 필요성을 인식하지 못하는 것 같습니다 사실 저도 그런 사람들 중에 한명이었습니다 하지만 항상 극한의 상황을 생각해야 하는 프로그래머의 현실;;</p>
<p>사실 어느정도 규모의 어플을 개발하다 보면 의존성 문제라는 것에 직면하게 되는 시기가 찾아오는 것 같습니다</p>
<p>하지만 dagger 혼자 시작하기도 힘들고 개념이나 사용법을 공부한다 하더라고 막상 어떻게 적용해야 할지 막막한 것이 현실입니다 저도 이해하는데 너무나 오래 걸렸고 사실 지금도 제대로 이해했는지 확신이 들지 않을 정도로 러닝커브가 긴 기술인것 같습니다</p>
<p>그런 분들을 위해 이 포스트는 dagger에 관련된 개념보다는 실제 코드 위주로 설명할 생각입니다</p>
<p>(사실 dagger에 관한 개념이나 전문적인 내용은 다른 곳에서 잘 찾아 볼수 있지만 그런 내용들을 보고 실제로 사용할 때 참고하면 좋을 것 같습니다)</p>
<p>그래도 포스트를 보는 분들의 편의성을 위해서 간단하게 개념 설명은 하고 넘어가야겠죠!</p>
<h1 id="heading"></h1>
<h2 id="di-dependence-injection">DI (dependence injection)</h2>
<p>이를 설명하기 위해선 DI(의존성 주입)에 대해 먼저 이야기해야 할것 같습니다</p>
<p>다른곳에서 이야기하는 개념을 먼저 설명하자면 의존성을 주입하는 이유는 Class A 가 Class B를 내부에 그냥 가지고 있으면 변하는 Class B가 변경된다거나 새롭게 Class C 를 생성해야하는 상황이 오면 매번 모든 class를 고쳐야한다고 합니다 이를 해결하기 위해 외부에서 객체를 생성해서 setter 같은 메소드를 이용해 객체를 주입하는 과정을 의존성 주입이라고 한다 하네요</p>
<p>여러분들은 이해가 가나요? 흠 대충 이해는 할수도 있을거 같긴 하네요 개념적으로는요 근데 정확히 어떤 상황이고 어떤 코드를 말하는건지 저는 감이 잘 안왔습니다</p>
<p>그럼 실제 상황을 고려해서 retrofit을 사용하는 상황이라고 생각해 봅시다 일반적인 상황이라면 그냥 하나의 retrofit을 사용하겠죠?
근데 만약 대부분의 API 에서 accessToken을 header에 담아 보내고 몇가지 API만 refreshToken을 담아 보내는 상황이라고 생각해봅시다</p>
<p>그럼 각각의 API를 불러올때마다 accessToken과 refreshToken을 담아서 작동시킬까요?
가능은 하겠지만 그다지 효율적인 방법은 아닌거 같네요 <code>그럼 보통 accessToken이 많으니 accessToken을 헤더에 미리 담아둬서 retrofit 객체를 만들어야겠네!</code> 음????
그럼 refreshToken은&hellip;?</p>
<p>아&hellip;. 여기까지 보셨으면 왜 의존성 주입이 필요한지 감이 오셨을거라 생각합니다</p>
<p>다시 개념을 볼까요</p>
<p><code>외부에서 객체를 생성해서 주입</code></p>
<p>음 그렇다면 accessToken을 담고 있는 retrofit 객체와 refreshToken을 담고 있는 retrofit 객체를 만들어 두고 필요할때마다 불러와서 쓰면 되겠네!!</p>
<p>라는 결론에 도달했습니다 여기까지 DI가 필요한 이유, 어디에 쓰이는지 생각해봤습니다</p>
<p>그럼 실제로 한번 적용해봐야겠죠!</p>
<h1 id="heading1"></h1>
<h2 id="dagger--">Dagger 의 기본개념</h2>
<ol>
<li>Inject</li>
<li>Component</li>
<li>Subcompoenet</li>
<li>Module</li>
<li>Scope</li>
</ol>
<p>Inejct</p>
<p>의존성 주입을 요청합니다. Inject 어노테이션으로 주입을 요청하면 연결된 Component가 Module로부터 객체를 생성하여 넘겨줍니다.</p>
<p>Component</p>
<p>연결된 Module을 이용하여 의존성 객체를 생성하고, Inject로 요청받은 인스턴스에 생성한 객체를 주입합니다. 의존성을 요청받고 주입하는 Dagger의 주된 역할을 수행합니다.</p>
<p>Subcomponent</p>
<p>Component는 계층관계를 만들 수 있습니다. Subcomponent는 Inner Class 방식의 하위계층 Component 입니다. Sub의 Sub도 가능합니다. Subcomponent는 Dagger의 중요한 컨셉인 그래프를 형성합니다. Inject로 주입을 요청받으면 Subcomponent에서 먼저 의존성을 검색하고, 없으면 부모로 올라가면서 검색합니다.</p>
<p>Module</p>
<p>Component에 연결되어 의존성 객체를 생성합니다. 생성 후 Scope에 따라 관리도 합니다.</p>
<p>Scope</p>
<p>생성된 객체의 Lifecycle 범위입니다. 안드로이드에서는 주로 PerActivity, PerFragment 등으로 화면의 생명주기와 맞추어 사용합니다. Module에서 Scope을 보고 객체를 관리합니다.</p>
<p>출처: <a href="https://medium.com/@maryangmin/di-%EA%B8%B0%EB%B3%B8%EA%B0%9C%EB%85%90%EB%B6%80%ED%84%B0-%EC%82%AC%EC%9A%A9%EB%B2%95%EA%B9%8C%EC%A7%80-dagger2-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-3332bb93b4b9">https://medium.com/@maryangmin/di-%EA%B8%B0%EB%B3%B8%EA%B0%9C%EB%85%90%EB%B6%80%ED%84%B0-%EC%82%AC%EC%9A%A9%EB%B2%95%EA%B9%8C%EC%A7%80-dagger2-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-3332bb93b4b9</a></p>
<h1 id="heading2"></h1>
<p>자 위의 내용은 다른 블로그에서 가져온 dagger의 정의입니다 여러분들은 이해가 가시나요? 흠 저는 느낌이 팍 오진 않네요</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Module
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">APIModule</span> {

    @SuppressLint(<span style="color:#e6db74">&#34;DefaultLocale&#34;</span>)
    @Provides
    @Singleton
    @ForAuthAPI
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">AuthRetrofit</span>(@ForAccessToken okHttpClient: OkHttpClient, ...
</code></pre></div><p>바로 실제 코드를 봅시다 저희가 개발하고 있는 코드중 일부이며 일단 <code>@Module</code>로 Module이라는 것을 알려주고 있네요</p>
<p><code>@Provides</code>로 객체를 만든다는걸 명시해주고 <code>@Singleton</code>으로 싱글톤패턴이라는 것도 명시하고 있군요 근데 <code>@ForAuthAPI</code>는 뭘까요?</p>
<p>사실 dagger를 사용하기 이전에 customAnnotation을 만들어 두었습니다</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Qualifier
@Retention(AnnotationRetention.RUNTIME)
<span style="color:#66d9ef">annotation</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ForAuthAPI</span>
</code></pre></div><p>이 부분에 대해서는 일단 뒤에 설명하기로 하고</p>
<p>자 일단 객체는 있으니 넣어주는 부분이 있지 않겠습니까?
한번 찾아보았습니다</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PostSignInUseCase</span> @Inject <span style="color:#66d9ef">constructor</span>(@ForAuthAPI retrofit: Retrofit, ...
</code></pre></div><p>엥? 아까 만들었던 어노테이션은 이따가 설명하기로 했으니 넘어간다해도 여기도 constructor에 retrofit 객체를 넣어주는 부분은 없군요 아 그럼 PostSignInUseCase를 사용하는 곳에서 넣어주겠네! 뭐 그럼 따라가 보죠</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginViewModel</span> @Inject <span style="color:#66d9ef">constructor</span>(application: Application,
                                         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> postSignInUseCase: PostSignInUseCase) : AndroidViewModel(application) {
</code></pre></div><p>??? 여기서도 객체를 안넣어주네요&hellip;&hellip;</p>
<p>자 다시 생각해보죠 dagger는 외부에서 객체를 생성후 주입한다고 했죠 사실 우리는 이미 module에서 객체를 생성했습니다 외부에서 객체를 생성해서 주입해주는 무언가를 스프링에서는 컨테이너, Dagger에서는 Component와 Module이라고 부릅니다</p>
<p>DI는 이렇게 의존성이 있는 객체의 제어를 외부 Framework로 올리면서 IoC 개념을 구현합니다. IoC는 Inversion of Control(제어의 역전)의 준말입니다.</p>
<p><code>'제어의 역전'</code> 다시말해 우리가 지금 처럼 객체를 넣어주는것이 아닌 객체가 필요한 곳에서 객체를 요청하는 방식이기에 제어가 역전되었다고 말하게 되는것이죠</p>
<p>개념을 다시 돌아보죠 객체를 요청하는것 <code>@Inject</code>를 사용하면 필요한 객체를 요청하게 되는겁니다</p>
<h4 id="-----">이제 다시 반대로 밑에서 부터 올라가보죠</h4>
<ol>
<li>@Inject를 통해 통해 PostSignInUseCase와 application을 가져옵니다</li>
<li>PostSignInUseCase에선 @Inject를 통해 retrofit 객체를 요청하네요</li>
<li>따라서 module에 미리 생성해둔 retrofit 객체를 가져오게 됩니다</li>
</ol>
<p>여기서 집고 넘어갈 부분은 @ForAuthAPI 라는 어노테이션을 통해서 retrofit 객체 중에서도 <code>AuthRetrofit</code> 을 가져왔다는 점입니다
만약 다른 retrofit 객체가 필요하다면 어노테이션을 새롭게 정의해 객체를 요구하는 쪽에서 필요한 객체에 맞는 어노테이션으로 요청하면 손쉽게 DI가 이루어집니다</p>
<p>마찬가지로 <code>@ForAccessToken</code> 도 만약 RefreshToken이 필요하다면 필요한 자리에 어노테이션만 바꾸면 되는것입니다</p>
<h1 id="heading3"></h1>
<p>retrofit을 중심적으로 이야기 하니 component와 scope에 대한 이야기가 빠져버렸네요</p>
<p>마찬가지로 간단한 예제를 통해 알아보죠</p>
<p>scope를 먼저 볼까요</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Provides
@ActivityScope
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">provideActivity</span>(): Activity {
    <span style="color:#66d9ef">return</span> activity
}
</code></pre></div><p>간단하게 생각해봅시다 객체의 LifeCycle 범위 즉 객체를 얼마동안 유지하느냐를 정해주겠네요
위의 경우엔 Activity가 유지되는 동안 존재하는 객체이겠네요</p>
<p>자 마지막으로 어찌보면 핵심이라고 할 수 있는 component에 대해 알아보죠</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Singleton
@Component(modules = arrayOf(
        ApplicationModule<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>,
        JsonParserModule<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>,
        SharedPreferenceModule<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>,
        HttpClientModule<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>,
        APIModule<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>,
        ...
</code></pre></div><p>위에 module이 필요한 객체를 생성한다고 했지만 component에 연결되어 있지 않으면 객체를 생성하지 않습니다 위에서 객체를 생성해 내려준것도 결국 미리 BaseApplication 통해 inject를 수행하고 component에서 객체생성을 요청했기 때문입니다</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        mBinding = DataBindingUtil.setContentView(<span style="color:#66d9ef">this</span>, R.layout.activity_main)

        BaseApplication.getAppComponent()
                .mainComponentBuilder()
                .activity(<span style="color:#66d9ef">this</span>)
                .build()
                .inject(<span style="color:#66d9ef">this</span>)
</code></pre></div><p>즉 component가 연결된 module들에게 객체생성을 요구하고 inject요청을 받으면 객체를 넘겨주었기 때문에 dagger가 잘 동작한다고 할 수 있겠네요 게다가 요청한 객체만 받아오니 더욱 효율적이겠죠</p>
<p>참고로 찾는 모듈이 없으면 부모의 component로 계속 이동하면서 찾는다고 하네요</p>
<h1 id="heading4"></h1>
<h2 id="heading5">마무리</h2>
<p>생각보다 길고 장황한 글이 된거 같네요 최대한 실제 코드와 비교해보며 어떻게 쓰이는지 활용가능한지 설명해 봤는데요 이해가 잘 되었나요?</p>
<p>제가 이해한 순서대로 나열했기 때문에 다른 방식으로 생각하시는 분들도 계실거라고 생각이 들긴 합니다</p>
<p>어쨋든 의존성문제를 해결하고 효율적으로 프로젝트를 진행하는 dagger, 잘 사용해서 도움이 되었으면 좋겠습니다 감사합니다</p>

            <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.yourssu.com%2fpost%2f%25EC%258B%25A4%25EC%25A0%259C%25EC%25BD%2594%25EB%2593%259C%25EB%25A1%259C-%25EC%2595%258C%25EC%2595%2584%25EB%25B3%25B4%25EB%258A%2594-dagger%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=%ec%8b%a4%ec%a0%9c%ec%bd%94%eb%93%9c%eb%a1%9c%20%ec%95%8c%ec%95%84%eb%b3%b4%eb%8a%94%20dagger&amp;url=https%3a%2f%2fblog.yourssu.com%2fpost%2f%25EC%258B%25A4%25EC%25A0%259C%25EC%25BD%2594%25EB%2593%259C%25EB%25A1%259C-%25EC%2595%258C%25EC%2595%2584%25EB%25B3%25B4%25EB%258A%2594-dagger%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=https%3a%2f%2fblog.yourssu.com%2fpost%2f%25EC%258B%25A4%25EC%25A0%259C%25EC%25BD%2594%25EB%2593%259C%25EB%25A1%259C-%25EC%2595%258C%25EC%2595%2584%25EB%25B3%25B4%25EB%258A%2594-dagger%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google&#43;"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.yourssu.com%2fpost%2f%25EC%258B%25A4%25EC%25A0%259C%25EC%25BD%2594%25EB%2593%259C%25EB%25A1%259C-%25EC%2595%258C%25EC%2595%2584%25EB%25B3%25B4%25EB%258A%2594-dagger%2f&title=%ec%8b%a4%ec%a0%9c%ec%bd%94%eb%93%9c%eb%a1%9c%20%ec%95%8c%ec%95%84%eb%b3%b4%eb%8a%94%20dagger" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

        </article>
        <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://yourssu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
    </main>
    <aside class="author">
  <img class="profile-image" src="https://blog.yourssu.com/img/profile-image.png" alt="유어슈" />
  <p class="name">by 
  <strong>유어슈</strong></p>
  <p class="address">숭실대학교 커뮤니티 그라운드 런칭!</p>
  <p class="link"></p>
  <ul class="social">
    










<li><a href="//instagram.com/ground_yourssu" class="icon-instagram" target="_blank" title="Instagram"></a></li>







<li><a href="//yourssu.com" class="icon-dribbble" target="_blank" title="hompage"></a></li>


<li><a href="https://blog.yourssu.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="https://blog.yourssu.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2021 &middot; Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="https:\/\/blog.yourssu.com\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="https://blog.yourssu.com/js/plugins.js"></script>




</body>
</html>

