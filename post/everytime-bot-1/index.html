<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Yourssu 기술 블로그</title>
        <meta name="author">
        <meta name="description" content="Yourssu Development blog ">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.60.1" />
        
        <link href='https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap" rel="stylesheet' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://blog.yourssu.com/css/styles.css">
        <link rel="icon" href="https://blog.yourssu.com/favicon.ico">
        <link rel="apple-touch-icon" href="https://blog.yourssu.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="https://blog.yourssu.com/css/highlightjs/monokai.css">
        <script src="https://blog.yourssu.com/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(https://blog.yourssu.com/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(https://blog.yourssu.com/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(https://blog.yourssu.com/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        
        <header class="site-header">
          <div class="transparent-layer">
              <a href="https://blog.yourssu.com/"><img src= "https://blog.yourssu.com/img/LOGO.png" alt="LOGO" class = "Logo_img"></a>
          </div>
        </header>

<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="https://blog.yourssu.com/" title="돌아가기">&laquo; 돌아가기</a>
            
<h1><a href="https://blog.yourssu.com/post/everytime-bot-1/" title="에브리타임 봇 제작기 - (1: 에타 크롤러)">에브리타임 봇 제작기 - (1: 에타 크롤러)</a></h1>

<footer class="post-info">Posted on <span class="post-meta"><time datetime="2020.03.09">2020.03.09</time>

    &middot; Tagged in
        
        <a href="https://blog.yourssu.com/tags/%EC%97%90%EB%B8%8C%EB%A6%AC%ED%83%80%EC%9E%84">에브리타임</a>, 
        
        <a href="https://blog.yourssu.com/tags/bot">bot</a>, 
        
        <a href="https://blog.yourssu.com/tags/crawling">crawling</a>, 
        
        <a href="https://blog.yourssu.com/tags/python">python</a>
        
    

</span>
</footer>

            <h1 id="----1--">에브리타임 봇 제작기 - (1: 에타 크롤러)</h1>
<p>안녕하세요. 유어슈 <strong>0G</strong> 입니다.</p>
<p>동아리 내에서는 대장 겸, 만능노예를 맡고있습니다.</p>
<p><br> 노예의 주 업무는 에브리타임에서 동아리 관련한 글에 답변을 다는 것입니다.</p>
<p>그러나 <strong>하나하나 매일 찾고 대응하는 것</strong> 이 보통 일이 아니더라고요.</p>
<p>그래서 생각했습니다.</p>
<br>
<h2 id="-">봇을 만들자!</h2>
<blockquote>
<p><br> 기획/마케팅 출신인 제가 이 짓을 시작하게 된 계기는 심플합니다. <br>개발팀한테 만들어달라 했는데 아무도 관심을 안줬기 때문입니다. <br>( 황금같은 일요일을 쉽게 낭비하는 법 )<br><br> <img src="https://i.imgur.com/Ee1x5ar.png" alt="slack_img"></p>
</blockquote>
<p><br><br></p>
<p>봇의 기본적인 구조는 19년도 2월에 작성된 네이버 블로그글을 참고했습니다.</p>
<p>링크: <a href="https://blog.naver.com/kbs4674/221460241196">https://blog.naver.com/kbs4674/221460241196</a></p>
<p>그러나 곧바로 문제점이 생겼습니다.</p>
<p><br> <strong>&raquo;나&hellip; 루비 할줄 모르는데?</strong></p>
<p>따라서 이번 글은 제가 통계할 때 쓰는 언어인</p>
<p><strong>Python</strong>으로 진행됩니다!</p>
<br>
<h3 id="--">* 우선한 고려사항</h3>
<p>에브리타임은 대부분 POST 방식을 채택합니다.</p>
<p>따라서 일반적으로 URL을 얻기보다는 <strong>크롬 개발자 도구</strong>를 통해 URL과 data 인자를 도출해야 했습니다.
(책에서는 이런거 안배웠는데)</p>
<p><br><br><br></p>
<h2 id="0-">0. 로그인</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PYTHON" data-lang="PYTHON"><span style="color:#f92672">import</span> requests

<span style="color:#75715e"># 로그인 정보</span>
LOGIN_INFO <span style="color:#f92672">=</span> {
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">userid</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">본인의 에타 아이디</span><span style="color:#e6db74">&#39;</span>,
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">password</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">본인의 에타 비밀번호</span><span style="color:#e6db74">&#39;</span>,
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">redirect</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">/</span><span style="color:#e6db74">&#39;</span>,
}
login_url <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">https://ssu.everytime.kr/user/login</span><span style="color:#e6db74">&#39;</span>
api_url <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">https://api.everytime.kr</span><span style="color:#e6db74">&#39;</span>

<span style="color:#75715e"># Session 생성</span>
<span style="color:#66d9ef">with</span> requests<span style="color:#f92672">.</span>Session() <span style="color:#66d9ef">as</span> s:
    login_res <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(login_url, data<span style="color:#f92672">=</span>LOGIN_INFO)

    <span style="color:#66d9ef">if</span> login_res<span style="color:#f92672">.</span>status_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>: <span style="color:#75715e">#log-in-check</span>
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Log-in Failed</span><span style="color:#e6db74">&#39;</span>)
    <span style="color:#75715e"># ~~~~~~~~~~~~~~~ Session 유지!</span>

</code></pre></div><p>먼저 로그인은 파이썬 기본 모듈인 requests 를 이용했습니다.</p>
<p>먼저, 개발자 도구로 로그인시 입력되는 폼 데이타를 확인해, 로그인 정보를 얻었습니다.</p>
<p>리다이렉트 되는 URL을 살펴보니, 학교마다 다른 서브도메인을 사용합니다.(숭실대학교는 &lsquo;ssu'를 사용)</p>
<p><br> 이후 기본 모듈인 requests.Session()을 통하여 세션을 생성합니다.</p>
<p>다행히 세션을 통해 에브리타임에 접속하는데는 큰 보안적 문제가 발생하지 않았습니다.</p>
<p>정상적으로 로그인이 되면 200을 반환하니, 이 부분에서 로그인이 잘됐는지 체크해줍니다!</p>
<p><br><br><br></p>
<h2 id="1-">1. 크롤링</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PYTHON" data-lang="PYTHON">everytime_board_list_yourssu <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(api_url <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">/find/board/article/list</span><span style="color:#e6db74">&#39;</span>, data<span style="color:#f92672">=</span>{
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">id</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">search</span><span style="color:#e6db74">&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">limit_num</span><span style="color:#e6db74">&#39;</span>: <span style="color:#ae81ff">20</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">start_num</span><span style="color:#e6db74">&#39;</span>: <span style="color:#ae81ff">0</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">moiminfo</span><span style="color:#e6db74">&#39;</span>: True,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">search_type</span><span style="color:#e6db74">&#39;</span>: <span style="color:#ae81ff">4</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">keyword</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">유어슈</span><span style="color:#e6db74">&#39;</span>,
    })
</code></pre></div><p>에브리타임의 게시글은</p>
<p><strong>도메인 값에 data 값을 post로 보내면, 게시글 list가 리턴</strong>되는 방식입니다. (블로그 참고)</p>
<p>주의 할 점은 제목이 있는 게시판의 경우 크롤링시 전체 내용이 아닌 짤린 내용을 반환합니다.</p>
<p>따라서 자유게시판과 같은 곳에서는 블로그와 같은 크롤링 후 text 내용에서 키워드를 서칭할 수 없는 문제가 발생합니다.</p>
<p><br><br><br>저는 <strong>유어슈</strong> 라는 키워드가 들어가 있는 모든 게시판의 글을 크롤링 하고 싶었기 때문에 상단 블로그의 방식과는 달리,</p>
<p>에브리타임에서 <strong>유어슈</strong> 를 검색한 후, 해당 페이지를 크롤링하기로 했습니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PYTHON" data-lang="PYTHON">everytime_board_list_yourssu <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>post(api_url <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">/find/board/article/list</span><span style="color:#e6db74">&#39;</span>, data<span style="color:#f92672">=</span>{
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">id</span><span style="color:#e6db74">&#39;</span>: <span style="color:#ae81ff">370455</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">limit_num</span><span style="color:#e6db74">&#39;</span>: <span style="color:#ae81ff">20</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">start_num</span><span style="color:#e6db74">&#39;</span>: <span style="color:#ae81ff">0</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">moiminfo</span><span style="color:#e6db74">&#39;</span>: True,
    })
</code></pre></div><p>그러나 혹시 모르니, 게시판 크롤링 코드와 주요 게시판 id를 같이 첨부합니다.</p>
<h3 id="---id">숭실대 주요 게시판 id</h3>
<blockquote>
<p>자유게시판: 370455<br>
비밀게시판: 257667<br>
졸업생게시판:385967<br>
새내기게시판:374637<br>
장터게시판: 370476<br></p>
</blockquote>
<br>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PYTHON" data-lang="PYTHON"><span style="color:#66d9ef">print</span>(everytime_board_list_yourssu<span style="color:#f92672">.</span>text)
</code></pre></div><p><img src="https://i.imgur.com/Nll1nln.png" alt="console"></p>
<p>마지막으로 프린트를 해서 콘솔로 확인하면</p>
<p>이 친구가 정상적으로 유어슈가 검색된 페이지를 xml형태로 긁어오는 것을 알 수 있습니다.</p>
<p><br><br><br>만약 데이터쪽에서 일하시는 분들이라면</p>
<p>손쉽게 xml 파일에서 텍스트를 긁어</p>
<p>wordcloud를 만들거나, 빈도를 계산하여 통계 자료로 작성하실 수 있을 겁니다.</p>
<p><br><br><br></p>
<p>다음 게시물에는 크롤링한 xml 데이터를 바탕으로</p>
<p>댓글을 작성하는 기능 구현을 올리러 오겠습니다!</p>
<p>안뇽! 감사! <strong>-3-)/</strong></p>

            <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.yourssu.com%2fpost%2feverytime-bot-1%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=%ec%97%90%eb%b8%8c%eb%a6%ac%ed%83%80%ec%9e%84%20%eb%b4%87%20%ec%a0%9c%ec%9e%91%ea%b8%b0%20-%20%281%3a%20%ec%97%90%ed%83%80%20%ed%81%ac%eb%a1%a4%eb%9f%ac%29&amp;url=https%3a%2f%2fblog.yourssu.com%2fpost%2feverytime-bot-1%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=https%3a%2f%2fblog.yourssu.com%2fpost%2feverytime-bot-1%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google&#43;"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.yourssu.com%2fpost%2feverytime-bot-1%2f&title=%ec%97%90%eb%b8%8c%eb%a6%ac%ed%83%80%ec%9e%84%20%eb%b4%87%20%ec%a0%9c%ec%9e%91%ea%b8%b0%20-%20%281%3a%20%ec%97%90%ed%83%80%20%ed%81%ac%eb%a1%a4%eb%9f%ac%29" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

        </article>
        <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://yourssu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
    </main>
    <aside class="author">
  <img class="profile-image" src="https://blog.yourssu.com/img/profile-image.png" alt="유어슈" />
  <p class="name">by 
  <strong>유어슈</strong></p>
  <p class="address">숭실대학교 커뮤니티 그라운드 런칭!</p>
  <p class="link"></p>
  <ul class="social">
    










<li><a href="//instagram.com/ground_yourssu" class="icon-instagram" target="_blank" title="Instagram"></a></li>







<li><a href="//yourssu.com" class="icon-dribbble" target="_blank" title="hompage"></a></li>


<li><a href="https://blog.yourssu.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="https://blog.yourssu.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2021 &middot; Powered by <a href="http://gohugo.io">Hugo</a>.</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="https:\/\/blog.yourssu.com\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="https://blog.yourssu.com/js/plugins.js"></script>




</body>
</html>

